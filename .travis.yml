language: php
php:
  - '8.0'
#  - nightly
before_install:
  - pecl install ast
  - sudo apt-get install -y libffi-dev
  - cp ffi.so `php-config --extension-dir`
install:
  - php -dextension=ffi.so `which composer` install
script:
  - vendor/bin/phan
  - vendor/bin/psalm
  - vendor/bin/phpcs
  - php -dextension=ffi.so genhelpers.php test/ && XDEBUG_MODE=coverage php -dextension=ffi.so vendor/bin/phpunit